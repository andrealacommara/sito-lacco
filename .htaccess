# ====================== ENABLE REWRITE ENGINE ======================

RewriteEngine On
RewriteBase /

# ====================== PERMANENT REDIRECTS (301) ======================

Redirect 301 /spotify https://open.spotify.com/intl-it/artist/6viihrUFd4eGCfv9w61tL7?si=CDBCI2pYT2axereXjLHUJA
Redirect 301 /instagram https://instagram.com/laccoverse
Redirect 301 /tiktok https://tiktok.com/@laccoverse
Redirect 301 /applemusic https://music.apple.com/it/artist/lacco/1773060241
Redirect 301 /youtube https://www.youtube.com/@Laccoverse

# Song redirects and more

Redirect 301 /tempo-perso https://distrokid.com/hyperfollow/lacco/tempo-perso-intro
Redirect 301 /mondo-dentro https://distrokid.com/hyperfollow/lacco/mondo-dentro
Redirect 301 /tra-le-nuvole https://distrokid.com/hyperfollow/lacco/tra-le-nuvole
Redirect 301 /tra-le-nuvole-sv https://distrokid.com/hyperfollow/lacco/tra-le-nuvole-sunset-version
Redirect 301 /cercami https://distrokid.com/hyperfollow/lacco/cercami-4
Redirect 301 /rumore-di-fondo https://distrokid.com/hyperfollow/lacco/rumore-di-fondo
Redirect 301 /nokoru-mono https://distrokid.com/hyperfollow/lacco/nokoru-mono
Redirect 301 /preview-nokoru-mono https://on.soundcloud.com/u3ZP1Y26moVlmrQSIO
Redirect 301 /tuxtu https://distrokid.com/hyperfollow/lacco/tu-x-tu

# ====================== STATIC FILES & SPA FALLBACK ======================

# Serve static files if they exist

RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# SPA fallback â†’ fall back to index.html

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]

# ====================== MIME TYPES ======================
# Register MIME types for modern image formats.
# Essential for mobile browsers (especially Safari / WebKit) which
# reject images served with incorrect Content-Type headers.
# Desktop Chrome is lenient and sniffs content; mobile browsers are not.

<IfModule mod_mime.c>
  AddType image/avif  .avif
  AddType image/webp  .webp
  AddType image/jpeg  .jpeg .jpg
  AddType font/woff2  .woff2
</IfModule>

# Fallback: explicit Content-Type headers for modern image formats.
# Needed on some shared hosting (e.g., Aruba) where mod_mime may not
# recognise .avif / .webp out of the box, or where the server's
# mime.types file is outdated.
<IfModule mod_headers.c>
  <FilesMatch "\.avif$">
    Header set Content-Type "image/avif"
  </FilesMatch>
  <FilesMatch "\.webp$">
    Header set Content-Type "image/webp"
  </FilesMatch>
</IfModule>

# ====================== COMPRESSION ======================

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/javascript application/json image/svg+xml application/xml
</IfModule>

# ====================== CACHE CONTROL ======================

# --- 1) HTML must NEVER be cached ---

<FilesMatch "\.(html)$">
Header set Cache-Control "no-cache, no-store, must-revalidate"
Header set Pragma "no-cache"
Header set Expires 0
</FilesMatch>

# --- 2) Press kit assets should NOT be cached ---

<FilesMatch "(photos\.zip|artwork\.zip|logo\.zip)$">
Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
</FilesMatch>

# --- 3) Icon / SEO files need short caching ---

<FilesMatch "^(og-image\.jpg|favicon\.ico|favicon\.svg|favicon-512\.png|apple-touch-icon\.png|android-chrome-192x192\.png|android-chrome-512x512\.png|mstile-150x150\.png)$">
Header set Cache-Control "public, max-age=3600"
</FilesMatch>

# --- 4) All hashed assets (safe to cache for 1 year) ---

<FilesMatch "\.(js|css|png|jpg|jpeg|gif|svg|ico|webp|avif|mp4|webm|woff2|ttf|eot)$">
Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>
