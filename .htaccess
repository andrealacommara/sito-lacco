# ====================== ENABLE REWRITE ENGINE ======================

RewriteEngine On
RewriteBase /

# ====================== PERMANENT REDIRECTS (301) ======================

Redirect 301 /spotify https://open.spotify.com/intl-it/artist/6viihrUFd4eGCfv9w61tL7?si=CDBCI2pYT2axereXjLHUJA
Redirect 301 /instagram https://instagram.com/laccoverse
Redirect 301 /tiktok https://tiktok.com/@laccoverse
Redirect 301 /applemusic https://music.apple.com/it/artist/lacco/1773060241
Redirect 301 /youtube https://www.youtube.com/@Laccoverse

# Song redirects

Redirect 301 /tempo-perso https://distrokid.com/hyperfollow/lacco/tempo-perso-intro
Redirect 301 /mondo-dentro https://distrokid.com/hyperfollow/lacco/mondo-dentro
Redirect 301 /tra-le-nuvole https://distrokid.com/hyperfollow/lacco/tra-le-nuvole
Redirect 301 /tra-le-nuvole-sv https://distrokid.com/hyperfollow/lacco/tra-le-nuvole-sunset-version
Redirect 301 /cercami https://distrokid.com/hyperfollow/lacco/cercami-4
Redirect 301 /rumore-di-fondo https://distrokid.com/hyperfollow/lacco/rumore-di-fondo

# ====================== STATIC FILES & SPA FALLBACK ======================

# Serve existing files normally

RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Redirect all other routes to index.html (SPA fallback)

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]

# ====================== COMPRESSION ======================

# Brotli is disabled by Aruba â€” enable DEFLATE safely

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/javascript application/json image/svg+xml
</IfModule>

# ====================== CACHE CONTROL ======================

# --- 1) Soft-cache SEO critical assets (NO hash) ---

# These must NOT be cached for a year or updates won't be visible (OG image, icons)

<FilesMatch "^(og-image\.jpg|favicon\.ico|favicon\.svg|favicon-512\.png|apple-touch-icon\.png|android-chrome-192x192\.png|android-chrome-512x512\.png|mstile-150x150\.png)$">
Header set Cache-Control "public, max-age=3600"
</FilesMatch>

# --- 2) Hard-cache hashed assets for 1 year (JS/CSS/images) ---

# Safe because their names change on every update

<FilesMatch "\.(js|css|png|jpg|jpeg|gif|svg|ico|webp|avif|mp4|webm|woff2|ttf|eot)$">
Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# --- 3) HTML should never be cached ---

<FilesMatch "\.(html)$">
Header set Cache-Control "no-cache, no-store, must-revalidate"
Header set Pragma "no-cache"
Header set Expires 0
</FilesMatch>
